# AWS Service Broker - Amazon MQ

<img align="left" src="https://s3.amazonaws.com/awsservicebroker/icons/aws-service-broker.png" width="120"><img align="right" src=https://s3.amazonaws.com/awsservicebroker/icons/AmazonRDS_LARGE.png width="108"><p align="center">Amazon MQ is a managed message broker service for Apache ActiveMQ that makes it easy to set up and operate message brokers in the cloud</p>&nbsp;

Table of contents
=================

* [Parameters](#parameters)
  * [production](#param-production)
  * [dev](#param-dev)
  * [custom](#param-custom)
* [Bind Credentials](#bind-credentials)
* [Examples](#kubernetes-openshift-examples)
  * [production](#example-production)
  * [dev](#example-dev)
  * [custom](#example-custom)

<a id="parameters"></a>

# Parameters

<a id = "param-production"></a>

Creates an Amazon MQ optimised for production use.  
Pricing: https://aws.amazon.com/amazon-mq/pricing/

### Required

At a minimum these parameters must be declared when provisioning an instance of this service

Name           | Description     | Accepted Values
-------------- | --------------- | ---------------
AccessCidr|CIDR block to allow to connect to Broker MQ|string

### Optional

These parameters can optionally be declared when provisioning

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
EngineVersion|Version of Broker Engine|5.15.9|5.15.9, 5.15.8, 5.15.6, 5.15.0
InstanceType|The instance type for the broker|mq.m5.large|mq.t2.micro, mq.m5.large, mq.m5.xlarge, mq.m5.2xlarge, mq.m5.4xlarge, mq.m4.large
PubliclyAccessible|Whether the broker can be accessed directly, outside of a VPC.|false|true, false
AutoMinorVersionUpgrade|Indicates that minor engine upgrades are applied automatically to the DB instance during the maintenance window.|true|true, false
PreferredMaintenanceWindowDay|The day of the week which RDS maintenance will be performed|SUNDAY|MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
PreferredMaintenanceWindowStartTime|The weekly start time in UTC for the RDS maintenance window, must be less than PreferredMaintenanceWindowEndTime.|04:00|00:00, 01:00, 02:00, 03:00, 04:00, 05:00, 06:00, 07:00, 08:00, 09:00, 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00, 18:00, 19:00, 20:00, 21:00, 22:00

### Generic

These parameters are required, but generic or require privileged access to the underlying AWS account, we recommend they are configured with a broker secret, see [broker documentation](/docs/) for details.

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
target_account_id | AWS Account ID to provision into(optional) ||
target_role_name | IAM Role name to provision with(optional), must be used in combination with target_account_id ||
region | AWS Region to create RDS instance in.| us-west-2 | ap-northeast-1, ap-northeast-2, ap-south-1, ap-southeast-1, ap-southeast-2, ca-central-1, eu-central-1, eu-west-1, eu-west-2, sa-east-1, us-east-1, us-east-2, us-west-1, us-west-2
VpcId|The ID of the VPC to launch the Cluster into||

### Prescribed

These are parameters that are prescribed by the plan and are not configurable, should adjusting any of these be required please choose a plan that makes them available.

Name           | Description     | Accepted Values
-------------- | --------------- | ---------------
AvailabilityZones|list of availability zones to use, Min 1, max 2 AZs|Auto
CidrBlocks|comma seperated list of CIDR blocks to place into|Auto
CidrSize|Size of Cidr block to allocate if CidrBlocks is set to Auto.|27
ConsoleAccess|Enables access to the the ActiveMQ Web Console for the ActiveMQ user.|true
Username|ActiveMQ Web Console access username|master
Password|ActiveMQ Web Console access password, if left at default a 32 character password will be generated. Not contain [.,=]. Minimum 12 characters, at least 4 unique characters|Auto
BrokerName|Broker Naeme will be autogenerated if set to "Auto".|Auto
DeploymentMode|The deployment mode of the broker.|ACTIVE_STANDBY_MULTI_AZ
AuditLog|Select the log type to publish to Amazon CloudWatch Logs.|true
GeneralLog|Select the log type to publish to Amazon CloudWatch Logs.|true

<a id = "param-dev"></a>

Creates an Amazon MQ optimised for dev/test use.  
Pricing: https://aws.amazon.com/amazon-mq/pricing/

### Required

At a minimum these parameters must be declared when provisioning an instance of this service

Name           | Description     | Accepted Values
-------------- | --------------- | ---------------
AccessCidr|CIDR block to allow to connect to Broker MQ|

### Optional

These parameters can optionally be declared when provisioning

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
EngineVersion|Version of Broker Engine|5.15.9|5.15.9, 5.15.8, 5.15.6, 5.15.0
InstanceType|The instance type for the broker|mq.m5.large|mq.t2.micro, mq.m5.large, mq.m5.xlarge, mq.m5.2xlarge, mq.m5.4xlarge, mq.m4.large
PubliclyAccessible|Whether the broker can be accessed directly, outside of a VPC.|false|true, false
AutoMinorVersionUpgrade|Indicates that minor engine upgrades are applied automatically to the DB instance during the maintenance window.|true|true, false
PreferredMaintenanceWindowDay|The day of the week which RDS maintenance will be performed|SUNDAY|MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
PreferredMaintenanceWindowStartTime|The weekly start time in UTC for the RDS maintenance window, must be less than PreferredMaintenanceWindowEndTime.|04:00|00:00, 01:00, 02:00, 03:00, 04:00, 05:00, 06:00, 07:00, 08:00, 09:00, 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00, 18:00, 19:00, 20:00, 21:00, 22:00

### Generic

These parameters are required, but generic or require privileged access to the underlying AWS account, we recommend they are configured with a broker secret, see [broker documentation](/docs/) for details.

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
target_account_id | AWS Account ID to provision into(optional) ||
target_role_name | IAM Role name to provision with(optional), must be used in combination with target_account_id ||
region | AWS Region to create RDS instance in.| us-west-2 | ap-northeast-1, ap-northeast-2, ap-south-1, ap-southeast-1, ap-southeast-2, ca-central-1, eu-central-1, eu-west-1, eu-west-2, sa-east-1, us-east-1, us-east-2, us-west-1, us-west-2
VpcId|The ID of the VPC to launch the RDS instance into||

### Prescribed

These are parameters that are prescribed by the plan and are not configurable, should adjusting any of these be required please choose a plan that makes them available.

Name           | Description     | Accepted Values
-------------- | --------------- | ---------------
AvailabilityZones|list of availability zones to use, Min 1, max 2 AZs|Auto
CidrBlocks|comma seperated list of CIDR blocks to place into|Auto
CidrSize|Size of Cidr block to allocate if CidrBlocks is set to Auto.|27
Username|ActiveMQ Web Console access username|master
Password|ActiveMQ Web Console access password, if left at default a 32 character password will be generated. Not contain [.,=]. Minimum 12 characters, at least 4 unique characters|Auto
BrokerName|Broker Naeme will be autogenerated if set to "Auto".|Auto
DeploymentMode|The deployment mode of the broker.|SINGLE_INSTANCE
AuditLog|Select the log type to publish to Amazon CloudWatch Logs.|false
GeneralLog|Select the log type to publish to Amazon CloudWatch Logs.|false

<a id = "param-custom"></a>

Creates an Amazon MQ with custom configuration.  
Pricing: https://aws.amazon.com/amazon-mq/pricing/

### Required

At a minimum these parameters must be declared when provisioning an instance of this service

Name           | Description     | Accepted Values
-------------- | --------------- | ---------------
AccessCidr|CIDR block to allow to connect to Broker MQ|

### Optional

These parameters can optionally be declared when provisioning

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
AccessCidr|CIDR block to allow to connect to Broker MQ||
VpcId|The ID of the VPC to launch the Broker instance into||
AvailabilityZones|list of availability zones to use, Min 1, max 2 AZs|Auto|
CidrBlocks|comma seperated list of CIDR blocks to place into|Auto|
CidrSize|Size of Cidr block to allocate if CidrBlocks is set to Auto.|27|
ConsoleAccess|Enables access to the the ActiveMQ Web Console for the ActiveMQ user.|false|true, false
Username|ActiveMQ Web Console access username|master|
Password|ActiveMQ Web Console access password, if left at default a 32 character password will be generated. Not contain [.,=]. Minimum 12 characters, at least 4 unique characters|Auto|
EngineVersion|Version of Broker Engine|5.15.9|5.15.9, 5.15.8, 5.15.6, 5.15.0
InstanceType|The instance type for the broker|mq.m5.large|mq.t2.micro, mq.m5.large, mq.m5.xlarge, mq.m5.2xlarge, mq.m5.4xlarge, mq.m4.large
BrokerName|Broker Naeme will be autogenerated if set to "Auto".|Auto|
PubliclyAccessible|Whether the broker can be accessed directly, outside of a VPC.|false|true, false
DeploymentMode|The deployment mode of the broker.|SINGLE_INSTANCE|SINGLE_INSTANCE, ACTIVE_STANDBY_MULTI_AZ
AuditLog|Select the log type to publish to Amazon CloudWatch Logs.|false|true, false
GeneralLog|Select the log type to publish to Amazon CloudWatch Logs.|false|true, false
AutoMinorVersionUpgrade|Indicates that minor engine upgrades are applied automatically to the DB instance during the maintenance window.|true|true, false
PreferredMaintenanceWindowDay|The day of the week which RDS maintenance will be performed|SUNDAY|MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
PreferredMaintenanceWindowStartTime|The weekly start time in UTC for the RDS maintenance window, must be less than PreferredMaintenanceWindowEndTime.|04:00|00:00, 01:00, 02:00, 03:00, 04:00, 05:00, 06:00, 07:00, 08:00, 09:00, 10:00, 11:00, 12:00, 13:00, 14:00, 15:00, 16:00, 17:00, 18:00, 19:00, 20:00, 21:00, 22:00

### Generic

These parameters are required, but generic or require privileged access to the underlying AWS account, we recommend they are configured with a broker secret, see [broker documentation](/docs/) for details.

Name            | Description     | Default         | Accepted Values
--------------- | --------------- | --------------- | ---------------
target_account_id | AWS Account ID to provision into(optional) ||
target_role_name | IAM Role name to provision with(optional), must be used in combination with target_account_id ||
region | AWS Region to create RDS instance in.| us-west-2 | ap-northeast-1, ap-northeast-2, ap-south-1, ap-southeast-1, ap-southeast-2, ca-central-1, eu-central-1, eu-west-1, eu-west-2, sa-east-1, us-east-1, us-east-2, us-west-1, us-west-2
VpcId|The ID of the VPC to launch the RDS instance into||

<a id="bind-credentials"></a>

# Bind Credentials

These are the environment variables that are available to an application on bind.

Name           | Description
-------------- | ---------------

# Kubernetes/Openshift Examples

***Note:*** Examples do not include generic parameters, if you have not setup defaults for these you will need to add them as additional parameters

<a id ="example-production"></a>

## production

### Minimal
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-production-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: production
  parameters: 
    AccessCidr: [VALUE]  
```


### Complete
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-production-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: production
  parameters: 
    AccessCidr: [VALUE]          
    DeploymentMode: ACTIVE_STANDBY_MULTI_AZ
    AuditLog: true
    GeneralLog: true
    AutoMinorVersionUpgrade: true
    PreferredMaintenanceWindowDay: SUNDAY
    PreferredMaintenanceWindowStartTime: 04:00
```


<a id="example-dev"></a>

## dev

### Minimal
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-dev-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: dev
  parameters: 
    AccessCidr: [VALUE] 
```


### Complete
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-dev-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: dev
  parameters: 
    AccessCidr: [VALUE]    
    DeploymentMode: SINGLE_INSTANCE
    AuditLog: false
    GeneralLog: false
    AutoMinorVersionUpgrade: true
    PreferredMaintenanceWindowDay: SUNDAY
    PreferredMaintenanceWindowStartTime: 04:00
```


<a id = "example-custom"></a>

## custom

### Minimal
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-custom-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: custom
  parameters: 
    AccessCidr: [VALUE]    
```


### Complete
```yaml
apiVersion: servicecatalog.k8s.io / v1beta1
kind: ServiceInstance
metadata: 
  name: mq-custom-complete-example
spec: 
  clusterServiceClassExternalName: mq
  clusterServicePlanExternalName: custom
  parameters: 
    AccessCidr: [VALUE]    
    AvailabilityZones: Auto
    CidrBlocks: Auto
    CidrSize: 27
    ConsoleAccess: false
    Username: master
    Password: Auto
    EngineVersion: 5.15.9
    InstanceType: mq.m5.large
    BrokerName: Auto
    PubliclyAccessible: false
    DeploymentMode: SINGLE_INSTANCE
    AuditLog: false
    GeneralLog: false
    AutoMinorVersionUpgrade: true
    PreferredMaintenanceWindowDay: SUNDAY
    PreferredMaintenanceWindowStartTime: 04:00
```


